openapi: 3.0.3
info:
  title: Mobility Ops 360 API
  description: |
    ã‚¿ã‚¯ã‚·ãƒ¼æ¥­ç•Œå‘ã‘AIé…è»Šã‚·ã‚¹ãƒ†ãƒ API
    
    ## ä¸»ãªæ©Ÿèƒ½
    - ğŸ™ï¸ AIéŸ³å£°é…è»Šï¼ˆTwilioçµ±åˆï¼‰
    - ğŸš— ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ãƒãƒƒãƒãƒ³ã‚°
    - ğŸ“ ä½ç½®æƒ…å ±ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°
    - ğŸ’° å‹•çš„æ–™é‡‘è¨ˆç®—
    - ğŸ” ã‚»ã‚­ãƒ¥ã‚¢èªè¨¼
  version: 1.0.0
  contact:
    name: Mobility Ops 360 Support
    email: support@mobility360.jp
    url: https://mobility360.jp
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: https://api.mobility360.jp
    description: Production server
  - url: https://mobi360-api.yukihamada.workers.dev
    description: Development server

security:
  - bearerAuth: []

tags:
  - name: Health
    description: ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
  - name: Auth
    description: èªè¨¼ãƒ»ç™»éŒ²
  - name: Voice Dispatch
    description: AIéŸ³å£°é…è»Š
  - name: Realtime
    description: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é…è»Š
  - name: Drivers
    description: ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ç®¡ç†
  - name: Dashboard
    description: ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
  - name: Twilio
    description: Twilioç®¡ç†

paths:
  /health:
    get:
      tags:
        - Health
      summary: ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
      description: ã‚·ã‚¹ãƒ†ãƒ ã®ç¨¼åƒçŠ¶æ³ã‚’ç¢ºèª
      security: []
      responses:
        '200':
          description: ã‚·ã‚¹ãƒ†ãƒ æ­£å¸¸ç¨¼åƒ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'

  /auth/register/company:
    post:
      tags:
        - Auth
      summary: ã‚¿ã‚¯ã‚·ãƒ¼ä¼šç¤¾ç™»éŒ²
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CompanyRegistration'
      responses:
        '201':
          description: ç™»éŒ²æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RegistrationResponse'
        '400':
          $ref: '#/components/responses/BadRequest'

  /auth/register/driver:
    post:
      tags:
        - Auth
      summary: ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ç™»éŒ²
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DriverRegistration'
      responses:
        '201':
          description: ç™»éŒ²æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RegistrationResponse'

  /auth/login:
    post:
      tags:
        - Auth
      summary: ãƒ­ã‚°ã‚¤ãƒ³
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /auth/verify:
    get:
      tags:
        - Auth
      summary: ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼
      responses:
        '200':
          description: ãƒˆãƒ¼ã‚¯ãƒ³æœ‰åŠ¹
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VerifyResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /api/voice-dispatch/create:
    post:
      tags:
        - Voice Dispatch
      summary: AIéŸ³å£°é…è»Šãƒªã‚¯ã‚¨ã‚¹ãƒˆä½œæˆ
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/VoiceDispatchRequest'
      responses:
        '201':
          description: é…è»Šãƒªã‚¯ã‚¨ã‚¹ãƒˆä½œæˆæˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VoiceDispatchResponse'

  /api/voice-dispatch/twiml/{dispatchId}:
    post:
      tags:
        - Voice Dispatch
      summary: TwiMLéŸ³å£°å¿œç­”ç”Ÿæˆ
      security: []
      parameters:
        - name: dispatchId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: TwiMLç”ŸæˆæˆåŠŸ
          content:
            application/xml:
              schema:
                type: string

  /api/realtime-dispatch:
    post:
      tags:
        - Realtime
      summary: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é…è»Š
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RealtimeDispatchRequest'
      responses:
        '200':
          description: é…è»ŠæˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RealtimeDispatchResponse'

  /api/drivers/location:
    post:
      tags:
        - Drivers
      summary: ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ä½ç½®æ›´æ–°
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LocationUpdate'
      responses:
        '200':
          description: ä½ç½®æ›´æ–°æˆåŠŸ

  /api/nearby-drivers:
    get:
      tags:
        - Drivers
      summary: è¿‘ãã®ãƒ‰ãƒ©ã‚¤ãƒãƒ¼æ¤œç´¢
      parameters:
        - name: latitude
          in: query
          required: true
          schema:
            type: number
            format: double
        - name: longitude
          in: query
          required: true
          schema:
            type: number
            format: double
        - name: radius
          in: query
          schema:
            type: number
            default: 5
      responses:
        '200':
          description: ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ä¸€è¦§
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NearbyDriversResponse'

  /api/dashboard/stats:
    get:
      tags:
        - Dashboard
      summary: çµ±è¨ˆæƒ…å ±å–å¾—
      responses:
        '200':
          description: çµ±è¨ˆãƒ‡ãƒ¼ã‚¿
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DashboardStats'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    HealthResponse:
      type: object
      properties:
        status:
          type: string
          enum: [healthy, degraded, unhealthy]
        timestamp:
          type: string
          format: date-time
        environment:
          type: string
        version:
          type: string

    CompanyRegistration:
      type: object
      required:
        - companyName
        - representativeEmail
      properties:
        companyName:
          type: string
        companyAddress:
          type: string
        companyPhone:
          type: string
        licenseNumber:
          type: string
        representativeName:
          type: string
        representativeEmail:
          type: string
          format: email
        serviceArea:
          type: string
        vehicleCount:
          type: integer
        driverCount:
          type: integer
        selectedPlan:
          type: string
          enum: [standard, premium, enterprise]

    DriverRegistration:
      type: object
      required:
        - name
        - email
      properties:
        name:
          type: string
        phone:
          type: string
        email:
          type: string
          format: email
        address:
          type: string
        birthdate:
          type: string
          format: date
        licenseNumber:
          type: string
        licenseExpiry:
          type: string
          format: date
        taxiLicenseNumber:
          type: string
        hasOwnVehicle:
          type: boolean
        isFullTime:
          type: boolean
        workingArea:
          type: string
        vehicleModel:
          type: string
        vehicleYear:
          type: string
        vehiclePlate:
          type: string

    LoginRequest:
      type: object
      required:
        - email
        - password
        - userType
      properties:
        email:
          type: string
          format: email
        password:
          type: string
        userType:
          type: string
          enum: [company, driver]

    LoginResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        data:
          type: object
          properties:
            user:
              type: object
            token:
              type: string

    VoiceDispatchRequest:
      type: object
      required:
        - customerName
        - customerPhone
        - pickupLocation
        - destination
      properties:
        customerName:
          type: string
        customerPhone:
          type: string
          pattern: '^\+?[1-9]\d{1,14}$'
        pickupLocation:
          type: string
        destination:
          type: string
        vehicleType:
          type: string
          enum: [standard, premium, wheelchair]
          default: standard
        notes:
          type: string

    VoiceDispatchResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        data:
          type: object
          properties:
            dispatchId:
              type: string
            assignedDriver:
              type: object
              properties:
                name:
                  type: string
                vehicleModel:
                  type: string
                vehiclePlate:
                  type: string
            estimatedArrival:
              type: integer
            twimlUrl:
              type: string

    RealtimeDispatchRequest:
      type: object
      required:
        - customerPhone
        - pickupLocation
        - destination
      properties:
        customerName:
          type: string
        customerPhone:
          type: string
        pickupLocation:
          type: string
        destination:
          type: string
        pickupLatitude:
          type: number
          format: double
        pickupLongitude:
          type: number
          format: double
        vehicleType:
          type: string
        priority:
          type: string
          enum: [normal, high, urgent]

    RealtimeDispatchResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        data:
          type: object
          properties:
            dispatchId:
              type: string
            assignedDriver:
              type: object
            estimatedArrival:
              type: integer
            estimatedFare:
              type: integer
            processingTime:
              type: integer

    LocationUpdate:
      type: object
      required:
        - driverId
        - latitude
        - longitude
      properties:
        driverId:
          type: string
        latitude:
          type: number
          format: double
        longitude:
          type: number
          format: double
        status:
          type: string
          enum: [active, busy, offline]

    NearbyDriversResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
          properties:
            searchLocation:
              type: object
              properties:
                latitude:
                  type: number
                longitude:
                  type: number
            searchRadius:
              type: number
            drivers:
              type: array
              items:
                type: object
            count:
              type: integer

    DashboardStats:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
          properties:
            companies:
              type: integer
            drivers:
              type: integer
            todayDispatches:
              type: integer
            activeDrivers:
              type: integer
            costReduction:
              type: number
            driverSufficiency:
              type: number
            profitIncrease:
              type: number
            systemUptime:
              type: number

    RegistrationResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        data:
          type: object
          properties:
            companyId:
              type: string
            userType:
              type: string

    VerifyResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
          properties:
            userId:
              type: string
            userType:
              type: string
            email:
              type: string

    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        error:
          type: string
        message:
          type: string
        timestamp:
          type: string
          format: date-time

  responses:
    BadRequest:
      description: ãƒªã‚¯ã‚¨ã‚¹ãƒˆä¸æ­£
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    
    Unauthorized:
      description: èªè¨¼ã‚¨ãƒ©ãƒ¼
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    
    NotFound:
      description: ãƒªã‚½ãƒ¼ã‚¹æœªç™ºè¦‹
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    
    InternalServerError:
      description: ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'