# 🎤 音声認識デバッグガイド

## 現在の問題
- ✅ 電話は繋がる
- ✅ AI音声案内は聞こえる
- ❌ こちらの声が認識されない

## 修正内容
音声認識の結果を受け取るコールバックURLを修正しました：
- 変更前: `${baseUrl}/api/voice/process-speech`（環境変数依存）
- 変更後: `https://mobility-ops-360-api.yukihamada.workers.dev/api/voice/process-speech`（固定）

## 🧪 テスト方法

1. **もう一度電話をかける**: +1 (959) 210-5018

2. **音声案内が流れたら、はっきりと話す**:
   - 「東京駅」
   - 「渋谷駅まで」
   - 「新宿から品川まで」

3. **話し終わったら少し待つ**（最大10秒）

## 🔍 音声認識のトラブルシューティング

### 認識されない場合のチェック項目:

1. **話すタイミング**
   - 「お迎え場所を教えてください」の後に話す
   - 話し始める前に1秒待つ

2. **話し方**
   - はっきりと話す
   - 背景雑音を避ける
   - 日本語で話す

3. **Twilioの設定確認**
   - Geographic Permissions（地理的許可）で日本が有効か
   - Speech Recognition が有効か

## 📊 デバッグ用ログ確認

```bash
# リアルタイムログを表示
npx wrangler tail --env production

# 別ウィンドウで電話をかけてログを確認
```

## 🎯 期待される動作

1. 電話に出る
2. 「お電話ありがとうございます...お迎え場所を教えてください」
3. あなた：「東京駅」と話す
4. AI：「お迎え場所は東京駅ですね。ドライバーを手配します...」
5. 通話終了

## ⚠️ 注意事項

- Twilioの音声認識は英語がデフォルトの場合があります
- 日本語認識のためには `language="ja-JP"` が重要（設定済み）
- 無音が10秒続くとタイムアウトします

## 🆘 それでも認識されない場合

1. **英語で試してみる**: "Tokyo Station" など
2. **DTMFトーンで試す**: 電話のキーパッドで数字を押す（`input="speech dtmf"`に変更が必要）
3. **Twilioコンソールでログ確認**: Monitor → Logs → Calls → 詳細を見る